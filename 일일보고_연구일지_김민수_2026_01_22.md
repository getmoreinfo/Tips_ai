# 일일보고_연구일지_김민수_2026_01_22

## 주요 항목 요약

### 오늘 달성
- **TranslateGemma 모델 탐색 및 테스트** (Google의 새로운 번역 모델)
- 한국어 → 베트남어 번역 시스템 구축
- 번역 속도 최적화 (텍스트당 **5분 24초 → 11초**, 약 **30배 개선**)
- 번역 품질 검증 및 문제 분석 (13건의 문제 발견)
- Shopee 베트남 이커머스 데이터 번역 준비 완료

### 이슈
- **번역 속도 문제**: 초기 테스트에서 텍스트당 5분 24초 소요 (13개에 1시간 10분)
- **번역 품질 문제**: 브랜드명 번역/변형 (10건), 키워드 오번역 (2건), 정보 누락 (1건)
- **모델 접근**: Gemma 라이선스 동의 및 Hugging Face 인증 필요

---

## 작업 내용 요약

### 1) TranslateGemma 모델 탐색

Google의 새로운 번역 모델 TranslateGemma 소개 및 검토

**모델 특징:**
- Gemma 3 기반 번역 모델 (4B, 12B, 27B 파라미터)
- 55개 언어 지원 (한국어, 베트남어 포함)
- 멀티모달 지원 (이미지-텍스트 번역 가능)
- 2단계 파인튜닝 (SFT + RL)

**활용 목적:**
- Shopee 베트남 이커머스 데이터를 한국어로 번역
- CSV 파일 및 클라우드 DB 데이터 처리

---

### 2) 번역 시스템 구축 (`test_translategemma_ko_to_vi.py`)

한국어 → 베트남어 번역 테스트 시스템 구현

```python
class TranslateGemmaTester:
    def __init__(self, model_size='4b', device='cuda'):
        # 모델: google/translategemma-4b-it
        # AutoProcessor, AutoModelForImageTextToText 사용
        # Hugging Face 토큰 인증 처리
    
    def translate(self, korean_text, source_lang='ko', target_lang='vi'):
        # TranslateGemma chat template 형식 사용
        # Processor.apply_chat_template()로 입력 처리
        # Greedy decoding으로 최적화
```

**주요 기능:**
- CSV 파일에서 샘플 데이터 번역
- 여러 컬럼 일괄 번역 (name, manufacturer, category_level1~3)
- 번역 결과 CSV 저장

**인증 처리:**
- Hugging Face 토큰 환경 변수 설정 (`HF_TOKEN`)
- Gemma 라이선스 동의 (gated repository)
- 토큰 권한 확인 및 자동 로그인

---

### 3) 번역 속도 최적화

**초기 성능:**
- 텍스트당 약 **5분 24초** (13개에 1시간 10분)
- `max_new_tokens=256`, `num_beams=4`

**최적화 조치:**
```python
# 생성 파라미터 최적화
max_new_tokens=32      # 256 → 32 (상품명은 짧으므로)
num_beams=1            # 4 → 1 (greedy decoding)
repetition_penalty=1.1 # 반복 방지
```

**최적화 후 성능:**
- 텍스트당 약 **11초** (10개에 약 1분 49초)
- **약 30배 속도 개선**

**성능 비교:**

| 항목 | 최적화 전 | 최적화 후 | 개선율 |
|------|----------|----------|--------|
| 텍스트당 시간 | 5분 24초 | 11초 | **30배** |
| 10개 처리 시간 | - | 1분 49초 | - |
| 50개 처리 시간 | 1시간 10분 (13개 기준 추정) | 약 9분 (예상) | **7.8배** |

---

### 4) 번역 품질 검증 및 문제 분석

`translation_check_report.csv` 기반 교차 검증 수행

**검증 결과 (`translation_validation_report.md`):**

#### 확인된 문제 (13건)

**1. 브랜드명/고유명사 번역 문제 (10건)**

| ID | 브랜드명 | 번역 결과 | 심각도 | 문제 |
|---|---|---|---|---|
| 2 | 반달 | Hình mặt trăng (달의 모양) | HIGH | 완전히 다른 의미로 번역 |
| 10 | 헬로미니미 | Chào bạn nhỏ (안녕 작은 친구) | HIGH | 브랜드명이 번역됨 |
| 6 | 아가짱 | Bé yêu (사랑하는 아기) | MEDIUM | 브랜드명이 번역됨 |
| 9 | 새들베이비 | Sẻ bé (작은 새) | MEDIUM | 브랜드명이 번역됨 |
| 5 | 지학사 | Nha xuất bản Địa Học | MEDIUM | 출판사명이 번역됨 |
| 4 | 어스본 | Earthson | MEDIUM | 정확한 브랜드명 아님 (Usborne) |
| 1,3 | 그린키즈 | Green Kids | MEDIUM | 의도적일 수 있으나 보존 권장 |
| 7 | 폴레드 | Poléd | MEDIUM | 음성학적 변형 |
| 8 | 에르고베이비 | Ergobaby | - | ✅ 정확 (실제 브랜드명) |

**2. 키워드 오번역 (2건)**

- **고구마 → khoai tây** (감자) ❌
  - 올바른 번역: `khoai lang` (고구마)
  
- **기저귀 → 누락** ❌
  - 원본: "기저귀 체크"
  - 번역: "quần áo trẻ em tiện lợi" (편리한 아기 옷)
  - 올바른 번역: `tã` 또는 `bỉm` (기저귀) 포함 필요

**3. 정보 누락 (1건)**

- **"1년" → 누락** ❌
  - 원본: "1년 정기구독"
  - 번역: "hàng năm" (매년)
  - 올바른 번역: `1 năm` 포함 필요

**문제 원인:**
- TranslateGemma가 고유명사를 일반 단어로 해석하여 번역
- 상품명의 특수 용어 인식 부족

**권장 해결 방안:**
1. 고유명사 사전 구축 및 번역 전/후 치환
2. 프롬프트에 "브랜드명은 번역하지 말 것" 지시 추가
3. 후처리 규칙 기반 고유명사 복원

---

### 5) Shopee 데이터 번역 준비 (`shopee_translate_translategemma.py`)

향후 Shopee 베트남 데이터를 한국어로 번역하기 위한 시스템 준비

```python
class ShopeeTranslator:
    def translate_from_csv(self, csv_path, columns_to_translate):
        # CSV 파일에서 데이터 읽기
        # 지정된 컬럼 번역
        # 결과 저장
    
    def translate_from_db(self, db_config, table_name):
        # PostgreSQL DB에서 데이터 읽기
        # 번역 후 DB에 저장
```

**지원 기능:**
- CSV 파일 입력/출력
- PostgreSQL DB 연동
- 배치 처리
- 진행 상황 표시

---

## 생성된 파일 목록

| 파일명 | 역할 |
|--------|------|
| `test_translategemma_ko_to_vi.py` | 한국어 → 베트남어 번역 테스트 |
| `shopee_translate_translategemma.py` | Shopee 데이터 번역 시스템 (향후 사용) |
| `setup_hf_token.py` | Hugging Face 토큰 설정 헬퍼 |
| `products_all_categorized_translated_vi.csv` | 번역 결과 (10개 샘플) |
| `translation_check_report.csv` | 번역 문제 체크리스트 |
| `translation_validation_report.md` | 번역 문제 교차 검증 보고서 |

---

## 모델 성능 요약

| 항목 | 값 | 비고 |
|------|-----|------|
| **번역 속도 (최적화 후)** | **11초/텍스트** | Greedy decoding |
| **10개 샘플 처리 시간** | **1분 49초** | 5개 컬럼 × 10개 = 50개 번역 |
| **번역 품질** | **양호** | 자연스러운 베트남어 번역 |
| **브랜드명 보존** | **미흡** | 10/10건 번역/변형됨 |
| **키워드 정확도** | **부분적** | 고구마→감자 오번역 등 |

---

## 정리

### 성과
- ✅ TranslateGemma 모델 성공적으로 테스트 및 적용
- ✅ 번역 속도 **30배 개선** (5분 24초 → 11초)
- ✅ 번역 품질 검증 시스템 구축
- ✅ Shopee 데이터 번역 준비 완료

### 발견된 문제
- ⚠️ 브랜드명/고유명사 번역 문제 (10건)
- ⚠️ 특수 용어 오번역 (고구마→감자 등)
- ⚠️ 숫자/정보 누락 (1년 등)

### 개선 필요 사항
- 🔧 고유명사 보존 메커니즘 도입 (필수)
- 🔧 번역 전/후 처리 파이프라인 구축
- 🔧 프롬프트 개선 (브랜드명 보존 지시)

---

## 다음 단계 계획

### 1. 번역 품질 개선
- 고유명사 사전 구축 및 자동 치환 시스템
- 번역 전/후 처리 파이프라인 구현
- 프롬프트 개선 (브랜드명 보존 지시 추가)

### 2. 실제 Shopee 데이터 적용
- Shopee 크롤링 데이터 수집
- 베트남어 → 한국어 번역 테스트
- 번역 품질 검증 및 개선

### 3. 대량 데이터 처리 최적화
- 실제 배치 처리 구현 (현재는 순차 처리)
- 병렬 처리 고려 (여러 GPU 또는 프로세스)
- 메모리 최적화

### 4. 번역 품질 자동 검증 시스템
- 번역 후 자동 검증 스크립트
- 브랜드명/고유명사 자동 감지 및 복원
- 키워드 정확도 검증

---

## 참고 자료

- **모델**: `google/translategemma-4b-it` (또는 12b-it, 27b-it)
- **라이선스**: Gemma License (Hugging Face에서 동의 필요)
- **설치**: `pip install transformers torch accelerate`
- **인증**: Hugging Face 토큰 설정 (`HF_TOKEN` 환경 변수)
- **문서**: https://huggingface.co/google/translategemma-4b-it
