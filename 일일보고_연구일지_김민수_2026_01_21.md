# 일일보고_연구일지_김민수_2026_01_21

## 주요 항목 요약

### 오늘 달성
- 분산 학습 관련 불필요 파일 정리 (17개 파일 삭제)
- 카테고리 계층 분리 및 `klue/roberta-base` 모델로 변경 (정확도 87% → **89%**)
- 감성 분석 모델 학습 (정확도 **72.37%** - 데이터 한계로 낮음)
- 상품 유사도 모델 구축 (경쟁 제품 분석용)
- 가격대 예측 모델 학습 (정확도 **78%**, 3단계 분류)
- 키워드 추출기 구현 (규칙 기반)
- **통합 리포트 생성기 완성** (상품/브랜드 분석 리포트 자동 생성)

### 이슈
- 감성 분석: 리뷰 태그 데이터의 클래스 불균형 (부정 리뷰 1개)으로 2클래스로 단순화
- 가격 예측: 5단계 → 3단계로 단순화해도 78%가 한계 (상품명만으로 가격 예측의 본질적 어려움)
- 키워드 추출: KeyBERT 방식 실패 (F1 10%), 규칙 기반으로 변경

---

## 작업 내용 요약

### 1) 분산 학습 관련 파일 정리

컴퓨터 3대 분산 학습이 실질적으로 불가능하여 관련 파일 삭제

**삭제된 파일 (17개):**
- MD 문서: `README_DISTRIBUTED.md`, `SETUP_DISTRIBUTED_TRAINING_STEP_BY_STEP.md` 등
- PowerShell 스크립트: `run_computer1~3.ps1`, `run_distributed_node1~3.ps1` 등
- Python: `02_finetune_distributed.py`

---

### 2) 카테고리 계층 분리 (`07_split_category_levels.py`)

기존 단일 카테고리를 대분류/중분류/소분류로 분리

```python
# 카테고리 분리 로직
# "홈 > 식품/유아/완구 > 유아의류/신발/도서 > 그림/동화/놀이책"
# → category_level1: 식품/유아/완구
# → category_level2: 유아의류/신발/도서
# → category_level3: 그림/동화/놀이책

def split_category(category_str):
    parts = [p.strip() for p in category_str.split('>')]
    if parts[0] == '홈':
        parts = parts[1:]
    return parts[0], parts[1] if len(parts) > 1 else None, parts[2] if len(parts) > 2 else None
```

**결과:** `products_all_categorized.csv` 생성

---

### 3) 카테고리 분류 모델 개선 (`05_train_category_classifier.py`)

모델을 `klue/roberta-base`로 변경하여 한국어 성능 향상

```python
# 모델 변경
model_name = "klue/roberta-base"  # intfloat/multilingual-e5-base → klue/roberta-base

# GPU 메모리 최적화
per_device_train_batch_size = 2
gradient_accumulation_steps = 16  # 효과적 배치: 32
fp16 = False  # CUDA 오류 방지
```

**학습 결과:** 정확도 **89%** (이전 87%)

---

### 4) 감성 분석 모델 (`10_train_sentiment_analyzer.py`)

리뷰 태그 기반 감성 분류 모델 학습

```python
# 감성 레이블 (2클래스로 단순화)
def get_sentiment(rating):
    if rating >= 4.7:
        return '매우긍정'
    else:
        return '긍정'

# 클래스 불균형으로 3클래스 → 2클래스
# 원래: 긍정/보통/부정 → 변경: 매우긍정/긍정
```

**결과:** 정확도 **72.37%** (데이터 한계)

| 문제점 | 설명 |
|--------|------|
| 클래스 불균형 | 부정 리뷰 1개뿐 |
| 데이터 특성 | 평점 4.5+ 상품이 대부분 |
| 리뷰 태그 유사성 | 긍정/매우긍정 태그가 비슷 |

---

### 5) 상품 유사도 모델 (`12_train_product_similarity.py`)

경쟁 제품 분석을 위한 임베딩 기반 유사도 모델

```python
# Sentence-BERT 모델 사용
model_name = "jhgan/ko-sroberta-multitask"
model = SentenceTransformer(model_name, device='cuda')

# 상품 텍스트 임베딩
texts = df['name'] + ' ' + df['manufacturer'] + ' ' + df['category_level3']
embeddings = model.encode(texts, batch_size=32, show_progress_bar=True)

# 코사인 유사도로 유사 상품 검색
similarities = cosine_similarity(query_embedding, product_embeddings)
```

**결과:** 11,356개 상품 임베딩 생성 완료

---

### 6) 가격대 예측 모델 (`14_train_price_predictor.py`)

상품명으로 가격대 예측

```python
# 가격대 분류 (3단계)
def get_price_range(price):
    if price < 30000:
        return '저가'      # 3만원 미만
    elif price < 100000:
        return '중가'      # 3만원 ~ 10만원
    else:
        return '고가'      # 10만원 이상
```

**학습 결과:**

| 가격대 | Precision | Recall | F1 |
|--------|-----------|--------|-----|
| 저가 | 82% | 93% | 87% |
| 중가 | 73% | 65% | 69% |
| 고가 | 75% | 56% | 64% |
| **전체** | **78%** | **78%** | **77%** |

---

### 7) 키워드 추출기 (`16_keyword_extractor_tfidf.py`)

상품명에서 핵심 키워드 추출

```python
# 규칙 기반 키워드 추출
class RuleBasedKeywordExtractor:
    def extract_keywords(self, name, manufacturer='', category=''):
        keywords = []
        
        # 1. 브랜드 매칭
        if manufacturer in self.brands:
            keywords.append(manufacturer)
        
        # 2. 패턴 추출 (단계, 용량, 형태)
        patterns = re.findall(r'\d단계|\d+(?:g|ml|kg|매|권)|[가-힣]+형', name)
        keywords.extend(patterns)
        
        # 3. 단어 추출
        words = name.split()
        keywords.extend(words)
        
        return keywords[:7]
```

**KeyBERT 실패 원인:**
- 임베딩 유사도가 "의미적 관련성"을 보장하지 않음
- 유아용품 도메인에서 모든 키워드가 비슷한 벡터 공간에 위치

---

### 8) 통합 리포트 생성기 (`18_report_generator.py`)

학습된 모델들을 조합한 자동 리포트 생성 시스템

```python
# 사용 모델
- 카테고리 분류 (89%)
- 가격대 예측 (78%)
- 상품 유사도 (경쟁 제품)
- 키워드 추출 (규칙 기반)

# 리포트 기능
def generate_product_report(product_name, manufacturer, category):
    # 1. 기본 정보 + 키워드
    # 2. 카테고리 예측
    # 3. 가격대 분석
    # 4. 유사 상품 (경쟁 제품)
    # 5. 브랜드 분석
    # 6. 카테고리 시장 분석
    # 7. 리뷰 키워드 분석
    # → ./reports/ 폴더에 마크다운 파일 저장

def generate_brand_report(manufacturer):
    # 1. 브랜드 개요
    # 2. 카테고리 분포
    # 3. 가격/평점 분석
    # 4. 리뷰 키워드 분석
    # 5. 인기 상품
    # 6. 경쟁 브랜드 분석 (시장 점유율)
```

**개선 사항:**
- nan 값 → "정보없음" 처리
- 긴 상품명 적절히 자르기
- 표 형식으로 깔끔한 출력
- 마크다운 파일 자동 저장 (`./reports/`)

---

## 생성된 파일 목록

| 파일명 | 역할 |
|--------|------|
| `07_split_category_levels.py` | 카테고리 계층 분리 |
| `products_all_categorized.csv` | 계층 분리된 상품 데이터 |
| `08_train_hierarchical_classifier.py` | 계층별 분류 모델 학습 |
| `10_train_sentiment_analyzer.py` | 감성 분석 모델 학습 |
| `11_use_sentiment_analyzer.py` | 감성 분석 모델 사용 |
| `12_train_product_similarity.py` | 상품 유사도 모델 학습 |
| `13_use_product_similarity.py` | 유사 상품 검색 |
| `14_train_price_predictor.py` | 가격대 예측 모델 학습 |
| `15_use_price_predictor.py` | 가격대 예측 사용 |
| `16_keyword_extractor_tfidf.py` | 키워드 추출기 |
| `18_report_generator.py` | **통합 리포트 생성기** |
| `./reports/*.md` | 생성된 리포트 파일들 |

---

## 모델 성능 요약

| 모델 | 정확도 | 비고 |
|------|--------|------|
| 카테고리 분류 | **89%** | klue/roberta-base |
| 가격대 예측 | **78%** | 3단계 (저가/중가/고가) |
| 감성 분석 | **72%** | 데이터 한계 |
| 상품 유사도 | - | 임베딩 기반 |
| 키워드 추출 | - | 규칙 기반 |

---

## 정리

- 다양한 AI 모델 학습 및 통합 완료
- **통합 리포트 생성기**로 상품/브랜드 분석 자동화
- 데이터 품질에 따른 모델 성능 한계 확인 (감성 분석, 가격 예측)
- 실용적인 규칙 기반 접근법의 효용성 확인 (키워드 추출)

---

## 다음 단계 계획

1. **리포트 품질 향상**
   - 더 많은 분석 항목 추가 (트렌드 분석, 계절성 등)
   - 시각화 차트 추가 (matplotlib/plotly)

2. **웹 인터페이스 구축**
   - Flask/FastAPI로 리포트 생성 API
   - 웹 대시보드 UI

3. **실서비스 적용**
   - 신규 상품 자동 분류 파이프라인
   - 정기 브랜드 리포트 자동 생성

4. **데이터 품질 개선**
   - 리뷰 텍스트 원본 수집 (감성 분석 개선)
   - 상품 스펙 정보 활용 (가격 예측 개선)
